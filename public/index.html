<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>God Sim World - Top Down</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="appRoot">
    <!-- INTRO SCREEN -->
    <section id="introScreen" class="screen visible">
      <div class="intro-container">
        <div class="intro-content">
          <div class="intro-logo">
            <h1 class="intro-title">God Sim World</h1>
            <div class="intro-particles">
              <span class="particle"></span>
              <span class="particle"></span>
              <span class="particle"></span>
              <span class="particle"></span>
              <span class="particle"></span>
            </div>
          </div>
          <p class="intro-tagline">Shape worlds. Create life. Play god.</p>
          <button id="btnStartIntro" class="intro-btn">Start</button>
          <div class="intro-features">
            <div class="feature">
              <span class="feature-icon">ğŸŒ</span>
              <span class="feature-text">Build Worlds</span>
            </div>
            <div class="feature">
              <span class="feature-icon">ğŸ§¬</span>
              <span class="feature-text">Evolve Creatures</span>
            </div>
            <div class="feature">
              <span class="feature-icon">ğŸ‘¥</span>
              <span class="feature-text">Multiplayer</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- MAIN MENU -->
    <section id="mainMenu" class="screen hidden">
      <div class="menu-container">
        <div class="menu-inner">
          <div class="main-menu-header">
            <h1 class="game-title">God Sim World</h1>
            <p class="game-subtitle">Grow a world of your own creatures, alone or with friends.</p>
          </div>
          <div class="menu-player-name">
            <div class="input-wrapper">
              <span class="input-icon">ğŸ‘¤</span>
              <input id="menuPlayerNameInput" placeholder="Display Name" />
            </div>
          </div>
          <div class="menu-buttons">
            <button id="btnNewWorld" class="primary menu-btn" disabled>
              <span class="btn-icon">ğŸŒŸ</span>
              <span class="btn-content">
                <span class="btn-title">Create New World</span>
                <span class="btn-subtitle">Start your own universe</span>
              </span>
            </button>
            <button id="btnMultiplayer" class="menu-btn" disabled>
              <span class="btn-icon">ğŸ‘¥</span>
              <span class="btn-content">
                <span class="btn-title">Multiplayer</span>
                <span class="btn-subtitle">Join a friend's world</span>
              </span>
            </button>
            <button id="btnYourWorlds" class="menu-btn" disabled>
              <span class="btn-icon">ğŸ—ºï¸</span>
              <span class="btn-content">
                <span class="btn-title">Your Worlds</span>
                <span class="btn-subtitle">Continue your creation</span>
              </span>
            </button>
            <button id="btnSettings" class="menu-btn" disabled>
              <span class="btn-icon">âš™ï¸</span>
              <span class="btn-content">
                <span class="btn-title">Settings</span>
                <span class="btn-subtitle">Customize your experience</span>
              </span>
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- NEW WORLD SCREEN -->
    <section id="newWorldScreen" class="screen hidden">
      <div class="menu-container">
        <div class="menu-inner">
          <div class="screen-header">
            <h2>Create New World</h2>
            <p class="screen-subtitle">Customize your universe</p>
          </div>
          <div class="form-card">
            <label class="modern-label">
              <span class="label-icon">ğŸŒ</span>
              <span>World name</span>
            </label>
            <input id="worldNameInput" placeholder="My island world" class="modern-input">
          </div>
          <div class="form-card">
            <label class="modern-label">
              <span class="label-icon">ğŸ“</span>
              <span>World Size</span>
            </label>
            <select id="worldSizeSelect" class="modern-input">
              <option value="64">Small (64x64)</option>
              <option value="96" selected>Medium (96x96)</option>
              <option value="128">Large (128x128)</option>
            </select>
          </div>
          <div class="form-card">
            <label class="modern-label">
              <span class="label-icon">ğŸï¸</span>
              <span>Island Size</span>
            </label>
            <input id="islandSizeSlider" type="range" min="20" max="80" value="50" class="modern-input">
            <span id="islandSizeValue">50%</span>
          </div>
          <div class="form-card">
            <label class="modern-label">
              <span class="label-icon">ğŸŒ¡ï¸</span>
              <span>Climate</span>
            </label>
            <select id="climateSelect" class="modern-input">
              <option value="tropical">Tropical (Warm & Wet)</option>
              <option value="temperate" selected>Temperate (Balanced)</option>
              <option value="arid">Arid (Hot & Dry)</option>
              <option value="cold">Cold (Cool & Dry)</option>
            </select>
          </div>
          <div class="form-card">
            <label class="modern-label">
              <span class="label-icon">ğŸ²</span>
              <span>Seed (optional)</span>
            </label>
            <input id="worldSeedInput" type="number" placeholder="Random" class="modern-input">
          </div>
          <div class="menu-buttons row">
            <button id="createWorldBtn" class="primary">
              <span>âœ¨</span> Create World
            </button>
            <button id="backFromNewWorldBtn">
              <span>â†</span> Back
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- MULTIPLAYER SCREEN (reuses old 'lobby' id) -->
    <section id="lobby" class="screen hidden">
      <div class="menu-container">
        <div class="menu-inner">
          <div class="menu-header-row">
            <div>
              <h2>Multiplayer</h2>
              <p class="screen-subtitle">Connect with other creators</p>
            </div>
            <button id="backFromMultiplayerBtn" class="back-btn">â† Back</button>
          </div>
          <div class="panel interactive-panel">
            <div class="panel-icon">ğŸŒ</div>
            <h3>Join a World</h3>
            <label class="modern-label">
              <span class="label-icon">ğŸ”‘</span>
              <span>World ID</span>
            </label>
            <input id="joinWorldIdInput" placeholder="Enter World ID" class="modern-input">
            <div class="menu-buttons" style="margin-top: 16px;">
              <button id="joinWorldBtn" class="primary">
                <span>ğŸš€</span> Join World
              </button>
            </div>
            <p class="hint">ğŸ’¡ Ask your friends for their world ID to join their universe.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- YOUR WORLDS SCREEN -->
    <section id="yourWorldsScreen" class="screen hidden">
      <div class="menu-container">
        <div class="menu-inner">
          <div class="menu-header-row">
            <div>
              <h2>Your Worlds</h2>
              <p class="screen-subtitle">Manage your created universes</p>
            </div>
            <button id="backFromYourWorldsBtn" class="back-btn">â† Back</button>
          </div>
          <div class="your-worlds-grid">
            <div class="panel interactive-panel">
              <div class="panel-header-actions">
                <h3>All Worlds</h3>
                <div style="display:flex; gap:8px; align-items:center;">
                  <button id="refreshWorldsBtn" class="refresh-btn">ğŸ”„ Refresh</button>
                  <button id="importWorldBtn" class="import-btn">ğŸ“¥ Import</button>
                  <input id="importWorldFile" type="file" accept="application/json" style="display:none">
                </div>
              </div>
              <ul id="worldList" class="world-list"></ul>
              <p class="hint">ğŸ’¡ Click a world to preview. Right-click to delete.</p>
            </div>
            <div class="panel interactive-panel" id="worldPreviewPanel">
              <div class="panel-header-actions">
                <h3>Preview</h3>
                <div class="preview-actions">
                  <button id="enterWorldBtn" class="primary" disabled>Enter World</button>
                  <button id="copyWorldIdBtn" disabled>Copy ID</button>
                  <button id="exportWorldBtn" disabled>Export</button>
                </div>
              </div>
              <div id="worldPreviewInfo" class="preview-info">Select a world to see details.</div>
              <div class="preview-canvas-wrap">
                <canvas id="worldPreviewCanvas" width="256" height="256"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- SETTINGS SCREEN -->
    <section id="settingsScreen" class="screen hidden">
      <div class="menu-container">
        <div class="menu-inner">
          <div class="menu-header-row">
            <div>
              <h2>Settings</h2>
              <p class="screen-subtitle">Customize your divine experience</p>
            </div>
            <button id="backFromSettingsBtn" class="back-btn">â† Back</button>
          </div>

          <div class="panel interactive-panel">
            <div class="panel-icon">ğŸ”Š</div>
            <h3>Audio</h3>
            <label class="modern-label">
              <span>Master volume</span>
              <input id="settingMasterVolume" type="range" min="0" max="1" step="0.05">
            </label>
            <label class="modern-label">
              <span>Creature sounds</span>
              <input id="settingCreatureVolume" type="range" min="0" max="1" step="0.05">
            </label>
            <label class="inline modern-checkbox">
              <input id="settingMute" type="checkbox">
              <span>Mute all sounds</span>
            </label>
          </div>

          <div class="panel interactive-panel">
            <div class="panel-icon">ğŸ‘ï¸</div>
            <h3>Visuals</h3>
            <label class="inline modern-checkbox">
              <input id="settingShowGrid" type="checkbox">
              <span>Show world grid</span>
            </label>
            <label class="inline modern-checkbox">
              <input id="settingReduceEffects" type="checkbox">
              <span>Reduce effects (for low-end devices)</span>
            </label>
          </div>
        </div>
      </div>
    </section>

    <!-- GAME SCREEN -->
    <section id="game" class="screen hidden">
      <div id="topBar">
        <div class="top-left">
          <span id="worldLabel"></span>
          <button id="copyJoinCodeBtn" title="Copy join code" style="margin-left:8px; padding:4px 8px; font-size:0.85rem;">Copy Code</button>
          <span id="playerLabel"></span>
          <span id="creatureCountLabel" style="margin-left: 15px;">ğŸ¦ 0</span>
        </div>
        <div class="top-center">
          <span id="xpLabel"></span>
          <span id="levelLabel"></span>
          <button id="pauseBtn" style="margin-left: 10px; padding: 4px 12px; font-size: 0.9rem;">â¸ï¸ Pause</button>
          <select id="speedSelect" style="margin-left: 10px; padding: 4px 8px; font-size: 0.9rem;">
            <option value="0.5">0.5x</option>
            <option value="1" selected>1x</option>
            <option value="2">2x</option>
            <option value="3">3x</option>
          </select>
          <button id="zoomInBtn" style="margin-left: 10px; padding: 4px 10px; font-size: 0.9rem;">ğŸ”+</button>
          <button id="zoomOutBtn" style="padding: 4px 10px; font-size: 0.9rem;">ğŸ”-</button>
          <button id="resetCameraBtn" style="padding: 4px 10px; font-size: 0.9rem;">Reset</button>
        </div>
        <div class="top-right">
          <button id="openSettingsInGameBtn">Settings</button>
          <button id="backToMainMenuBtn">Exit to Main Menu</button>
        </div>
      </div>
      
      <div id="toolbar">
        <div class="toolbar-section">
          <h4>Creator</h4>
          <button id="toolbarCreatorBtn" class="toolbar-btn">
            <span>ğŸ¨</span> Creature Creator
          </button>
        </div>
        <div class="toolbar-section">
          <h4>Powers</h4>
          <button id="powerTerraformBtn" class="toolbar-btn" disabled>
            <span>â›°ï¸</span> Terraform
          </button>
          <button id="powerFertilityBtn" class="toolbar-btn" disabled>
            <span>ğŸŒ±</span> Fertility
          </button>
          <button id="powerRainBtn" class="toolbar-btn" disabled>
            <span>ğŸŒ§ï¸</span> Rain
          </button>
          <button id="powerHeatwaveBtn" class="toolbar-btn" disabled>
            <span>â˜€ï¸</span> Heatwave
          </button>
        </div>
        <div class="toolbar-section">
          <h4>View</h4>
          <button id="viewBiomeBtn" class="toolbar-btn active">Biomes</button>
          <button id="viewFoodBtn" class="toolbar-btn">Food</button>
          <button id="viewTempBtn" class="toolbar-btn">Temperature</button>
        </div>
      </div>

      <div id="mainArea">
        <div id="canvasContainer">
          <canvas id="gameCanvas" width="768" height="768"></canvas>
        </div>
        <div id="sidebar">
          <div class="panel sidebar-section">
            <h3>Players</h3>
            <ul id="playersList" class="players-list"></ul>
          </div>

          <div id="creatorPanel" class="panel" style="display: none;">
            <div class="panel-header">
              <h3>Creature Creator</h3>
            </div>
            <p>Draw with your mouse or upload an image, then record a sound.</p>
            <canvas id="creatureCanvas" width="128" height="128"></canvas>
            <div class="row gap">
              <button id="clearCreatureCanvasBtn">Clear</button>
              <input type="file" id="creatureImageUpload" accept="image/*">
            </div>
            <div class="sound-controls">
              <button id="startRecordingBtn">Record</button>
              <button id="stopRecordingBtn" disabled>Stop</button>
              <span id="recordingStatus">No sound recorded</span>
            </div>
            <div class="form-grid">
              <label>
                <span>Name</span>
                <input id="creatureNameInput" placeholder="Species name">
              </label>
              <label>
                <span>Diet</span>
                <select id="creatureDietSelect">
                  <option value="plant">Plant eater</option>
                  <option value="omnivore">Omnivore</option>
                  <option value="carnivore">Carnivore</option>
                </select>
              </label>
              <label>
                <span>Size</span>
                <input id="creatureSizeInput" type="number" value="1" min="0.5" max="3" step="0.1">
              </label>
              <label>
                <span>Speed</span>
                <input id="creatureSpeedInput" type="number" value="1" min="0.5" max="3" step="0.1">
              </label>
            </div>
            <button id="createCreatureTypeBtn" class="primary full">Create Species</button>
            <p class="hint">Select a species below, then click on the world to spawn it.</p>
          </div>

          <div class="panel sidebar-section">
            <h3>Known Species</h3>
            <ul id="speciesList"></ul>
          </div>

          <div class="panel sidebar-section">
            <h3>Tile Info</h3>
            <div id="tileInfo"></div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script src="client.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const menuPlayerNameInput = document.getElementById('menuPlayerNameInput');
      const buttons = document.querySelectorAll('#btnNewWorld, #btnMultiplayer, #btnYourWorlds, #btnSettings');

      function validatePlayerName() {
        const name = menuPlayerNameInput.value.trim();
        return name.length > 0;
      }

      function toggleButtons() {
        const isValid = validatePlayerName();
        buttons.forEach(button => button.disabled = !isValid);

        if (!isValid) {
          showNotification('Please enter your display name first.', 'warning', 0); // Notification stays until name is entered
        }
      }

      menuPlayerNameInput.addEventListener('input', () => {
        const isValid = validatePlayerName();
        if (isValid) {
          clearNotifications(); // Clear all notifications once the name is valid
        }
        toggleButtons();
      });

      // Initial validation on page load
      toggleButtons();

      // Open settings in-game
      const openSettingsInGameBtn = document.getElementById('openSettingsInGameBtn');
      if (openSettingsInGameBtn) {
        openSettingsInGameBtn.addEventListener('click', () => {
          // Explicitly set game as previous screen before showing settings
          previousScreen = document.getElementById('game');
          showScreen(document.getElementById('settingsScreen'), false);
        });
      }
    });
  </script>
</body>
</html>
